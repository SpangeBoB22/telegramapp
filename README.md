
# Агрегатор та аналізатор новин

Додаток має наступну функціональність, доступну з командного рядка:
<ul>
<li>Збір повідомлень з заданих конфігурацією Телеграм-каналів, індексація їх у <i>ElasticSearch</i></li>
<li>Агрегація та аналіз повідомлень в активному та фоновому режимах:
<ul>
<li>Виділення тексту новини з початкового тексту повідомлення в Телеграм-каналі;</li>
<li>Виділення іменованих сутностей;</li>
<li>Самаризація текстів інформаційних повідомлень;</li>
<li>Визначення тональності та категорії новин;</li>
</ul>
Виділені іменовані сутності, тональність, категорії новин можуть бути використані для візуалізації на дашбордах <i>Kibana</i>.</li>
<li>Завантаження даних в індекс з файлів <i>JSON</i>, збереження даних індексу у <i>JSON</i>.</li>
</ul>

## Вимоги:
<ol>
<li><b>Python 3.12</b> - основна мова реалізації проєкту</li>
<li>Встановлені бібліотеки відповідно до <i>requirements.txt</i></li>
<li><b>Docker</b> - для розгортання системи повнотекстового пошуку ElasticSearch та Kibana</li>
<li>Доступ до одного з API великих мовних моделей: <i>Open AI API</i> або <i>Gemini API</i></li>
</ol>

## Початок роботи

Ці інструкції допоможуть вам запустити копію проєкту на вашому локальному комп'ютері для розробки та тестування.

### Передумови

Переконайтеся, що у вас встановлено необхідне програмне забезпечення для роботи з проєктом.

#### Встановлення Python

1. Встановіть Python згідно з інструкціями для вашої операційної системи на [офіційному сайті Python](https://www.python.org/downloads/).

#### Створення віртуального оточення

Використовуйте PowerShell для створення та активації віртуального оточення:

```powershell
# Створення віртуального оточення
python -m venv venv

# Активація віртуального оточення
.\venv\Scripts\Activate.ps1
```

#### Встановлення залежностей

Встановіть необхідні залежності з файла `requirements.txt`.

```powershell
pip install -r requirements.txt
```

#### Встановлення Elasticsearch та Kibana

Слідуйте інструкціям з офіційного сайту для встановлення [Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html) та [Kibana](https://www.elastic.co/guide/en/kibana/current/install.html).

#### Додавання .env файлу

Додайте файл `.env` з ключем для Elasticsearch та ключем щонайменше одного з API у кореневій директорії проєкту.
Використовуйте sample.env як зразок. Зберігання токенів в системних змінних забезпечує вищий рівень безпеки у порівнянні
із зберіганням у конфігураційному файлі.

Посилання на інструкції по реєстрації користувача API мовних моделей:
- [Gemini API](https://ai.google.dev/gemini-api/docs/api-key)
- [Open AI API](https://platform.openai.com/docs/overview)

#### Отримання API_ID та API_HASH для Telegram

Отримайте `API_ID` та `API_HASH` на [відповідному ресурсі Telegram](https://my.telegram.org/apps).

#### Формування файла `api_data.json`

Сформуйте файл за зразком `api_data_example.json` та зашифруйте його використовуючи запуск скрипта Python.
```powershell
python cli.py encrypt-config /path/to/file/to_encrypt.json <<password>>
```
Додайте опцію --delete-initial-file для автоматичного видалення первинного файлу

Після шифрування помістіть файл у кореневу директорію проекту.
Бажано видалити незашифровану копію, якщо вона не була видалена автоматично.

#### Створення переліку каналів

Для створення переліку каналів запустіть додаток в режимі отримання переліку каналів
```powershell
python cli.py list-channels 1 --password <<password>>
```
В параметрі <<password>> необхідно вказати пароль, яким було зашифровано api_data.json

З отриманого переліку каналів треба вибрати канали, що мають бути додані до моніторингу, 
й змінити відповідним чином файл, що визначає завдання парсингу.
Ім'я файлу задається в конфігураційному файлі, за замовчанням це <i>pars_config.json</i>.
Формат файлу наступний:

<i><b>
{"<<worker_id_1": [<<channel_1_1>>, <<channel_1_2>>, <<channel_1_3>>],


 "<<worker_id_2": [<<channel_2_1>>, <<channel_2_2>>]
}
</i></b>

#### Оновлення налаштувань у `config.cfg`

Оновіть налаштування в файлі `config.cfg` за допомогою текстового редактора.

### Доступні команди командного рядка:

Для отримання переліку доступних команд
```powershell
python cli.py --help
```

Для отримання переліку доступних команд з усіма опціями
```powershell
python cli.py detailed-help
```

1. Шифрування конфігураційного файла
```powershell
python cli.py encrypt-config --password <<password>>
```

2. Вивід в консоль (або в файл) переліку каналів для заданого worker
```powershell
python cli.py list-channels <<worker_id>> --password <<password>>
```
Для вивода в файл слід додати опцію <i>--output</i>
```powershell
python cli.py list-channels <<worker_id>> --password <<password>> -- output /path/to/output/file
```

3. Запуск одного worker (читання за визначеним в параметрі набором API_ID/API_HASH)
```powershell
python cli.py start-single-reader <<worker_id>> --password <<password>>
```

4. Для запуску усіх worker (читання за усіма наборами API_ID/API_HASH)
```powershell
python cli.py start-all-readers --password <<password>>
```

5. Для запису вмісту індексу Elasticsearch у файли JSONL (JSON-lines) використовується команда _dump-index_.
Для створення дампу достатньо вказати шлях до папки, в яку слід зберегти вміст індексу (підтримуються відносні шляхи).
Якщо залишити параметр порожнім, файли будуть збережені у поточну папку (не рекомендовано). 
Кожному ресурсу (каналу) відповідає окремий файл.

```powershell
python cli.py dump-index -/path/to/output/folder
```

Якщо треба зробити дамп лише для окремого ресурсу (каналу), слід додати опцію з його ім'ям
```powershell
python cli.py dump-index /path/to/output/folder --source <<channel name>>
```

6. Завантаження даних виконується командою _load-data_.
```powershell
python cli.py load-data /path/to/input/folder 
```

7. Опрацювання повідомлень в індексі з використанням мовних моделей
- __clear_and_ner__ - очищення та форматування тексту, виділення іменованих сутностей
- __summary__ - самаризація (summary) текстів повідомлень
- __tonality__ - визначення тональності повідомлень, використовується для розмітки тренувального набору
- __topics__ - визначення категорії інформаційного повідомлення, використовується для візуалізації розподілення категорій в _Kibana_

```powershell
python cli.py llm-process <<action>> 
```

Якщо треба опрацювати лише окремий ресурс
```powershell
python cli.py llm-process <<action>> --source <<channel name>>
```

8. Запуск утіліти, що опрацьовує періодично нові повідомлення, формуючи усю інформацію, перелічену в попередньому пункті.
```powershell
python cli.py process
```