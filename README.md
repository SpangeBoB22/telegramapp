
# Агрегатор новин

Це консольний додаток, який збирає дані з новинних телеграм-каналів в асинхронному режимі та записує їх до індексу Elasticsearch. Для обробки великої кількості повідомлень, додаток використовує асинхронну архітектуру, асинхронну неблокуючу чергу, а також запис у індекс партіями (batch), що оптимізує час запису. Окрім консольного режиму додаток також може бути запущено як сервіс або daemon.


## Початок роботи

Ці інструкції допоможуть вам запустити копію проекту на вашому локальному комп'ютері для розробки та тестування.

### Передумови

Переконайтеся, що у вас встановлено необхідне програмне забезпечення для роботи з проектом.

#### Встановлення Python

1. Встановіть Python згідно з інструкціями для вашої операційної системи на [офіційному сайті Python](https://www.python.org/downloads/).

#### Створення віртуального оточення

Використовуйте PowerShell для створення та активації віртуального оточення:

```powershell
# Створення віртуального оточення
python -m venv venv

# Активація віртуального оточення
.\venv\Scripts\Activate.ps1
```

#### Встановлення залежностей

Встановіть необхідні залежності з файла `requirements.txt`.

```powershell
pip install -r requirements.txt
```

#### Встановлення Elasticsearch та Kibana

Слідуйте інструкціям з офіційного сайту для встановлення [Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html) та [Kibana](https://www.elastic.co/guide/en/kibana/current/install.html).

#### Додавання .env файлу

Додайте файл `.env` з ключем для Elasticsearch у кореневій директорії проекту. Використовуйте sample.env в якості зразка. Зберігання токенів в системних змінних забезпечує більш високий рівень безпеки у порівнянні з зберіганням у конфігураційному файлі.

#### Отримання API_ID та API_HASH для Telegram

Отримайте `API_ID` та `API_HASH` на [відповідному ресурсі Telegram](https://my.telegram.org/apps).

#### Формування файла `api_data.json`

Сформуйте файл за зразком `api_data_example.json` та зашифруйте його використовуючи запуск скрипта Python.
```powershell
python cli.py encrypt-config /path/to/file/to_encrypt.json <<password>>
```
Додайте опцію --delete-initial-file для автоматичного видалення первинного файлу

Після шифрування помістіть файл у кореневу директорію проекту.
Бажано видалити незашифровану копію, якщо вона не була видалена автоматично.

#### Створення переліку каналів

Для створення переліку каналів запустіть додаток в режимі отримання переліку каналів
```powershell
python cli.py list-channels --worker_id 1 --password <<password>>
```
В параметрі <<password>> необхідно вказати пароль, яким було зашифровано api_data.json

З отриманого переліку каналів треба вибрати канали, що мають бути додані до моніторингу, й змінити відповідним чином файл, що визначає завдання парсингу. Ім'я файлу задається в конфігураційному файлі, за замовчанням це <i>pars_config.json</i>. Формат файлу наступний:

<i><b>
{"<<worker_id_1": [<<channel_1_1>>, <<channel_1_2>>, <<channel_1_3>>],


 "<<worker_id_2": [<<channel_2_1>>, <<channel_2_2>>]
}
</i></b>

#### Оновлення налаштувань у `config.cfg`

Оновіть налаштування в файлі `config.cfg` за допомогою текстового редактора.

### Запуск застосунку

Запустіть застосунок з командного рядка використовуючи одну з доступних команд:
1. Для запуску одного worker (читання за визначеним в параметрі набором API_ID/API_HASH)
```powershell
python cli.py start-single-reader --worker_id 1 --password <<password>>
```
2. Для запуску усіх worker (читання за усіма наборами API_ID/API_HASH)
```powershell
python cli.py start-all-readers --password <<password>>
```

Переглядайте лог виконання у <i>tg_app.log</i>, файл ротується кожні 24 години, історія зберігається на протязі тижня.
